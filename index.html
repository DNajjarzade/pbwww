<!DOCTYPE html>
<html>
  <head>
    <title>pb - Web form by sudokode</title>

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">

    <link rel="icon" type="image/png" href="https://ptpb.pw/static/images/ptpb-32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="https://ptpb.pw/static/images/ptpb-128.png" sizes="128x128" />
    <link rel="icon" type="image/png" href="https://ptpb.pw/static/images/ptpb-512.png" sizes="512x512" />

    <link href="https://ptpb.pw/static/css/pbs.css" type="text/css" rel="stylesheet"/>
    <link href="https://ptpb.pw/static/default.css" type="text/css" rel="stylesheet"/>

    <script src="//code.jquery.com/jquery-1.12.0.min.js"></script>
  <style>
    .center {
      text-align: center;
    }

    #heading {
      margin-bottom: 3em;
    }

    #text {
      border:none;
      box-shadow:none;
      outline:none;
      background-color:#F8F8F8;
      width:100%;
      padding:0.5em;
      font-family:monospace;
    }

    #paste {
      width:80%;
      margin: auto;
    }

    #private {
      margin-left: 2em;
    }

    .label {
      font-size: 1em;
      color: black;
      font-weight: normal;
    }

    #expire {
      min-width: 6em;
      max-width: 7em;
    }

    #paste_response,#paste_error {
      width: 50%;
      margin: auto;
    }

    #buttons {
      margin-top: 0.5em;
    }

    #buttons button {
      margin-left: 0.5em;
    }

    #footer {
      margin-top: 3em;
    }
  </style>
  </head>
  <body>
  <div id="heading" class="center">
    <h1><a href="https://ptpb.pw/" target="_blank">ptpb.pw</a></h1>
    <p><h3>A website to paste shit</h3></p>
    <p>You're welcome</p>
  </div>

    <div id="paste_form">
      <form id="paste" action="https://ptpb.pw/" method="POST" enctype="multipart/form-data">
        <textarea id="text" rows="20" cols="150" autofocus></textarea>
        <div id="buttons" class="center">
          <button id="clear">Clear</button>
          <button id="shorten">Shorten</button>
          <button id="submit">Paste</button>
          <input type="checkbox" id="private" name="p" /><span class="label">Private</span></input>
          <input type="number" id="expire" name="s" placeholder="Expires in..." /><label for="expire" class="label">seconds</label>
          <input type="file" id="file" name="c" />
        </div>
      </form>
    </div>

    <div id="paste_response" hidden="true">
      url: <a id="response_url" target="_blank"></a><br />
      status: <span id="response_status"></span><br />
      uuid: <span id="response_uuid"></span>
    </div>

    <div id="paste_error" hidden="true"></div>

    <script type="text/javascript">
      $(document).ready(function() {
        $("#clear").click(function(e) {
          e.preventDefault();
          $("#text").val("");
          $("#private").prop("checked", false);
          $("#expire").val("");
        });

        function getData() {
          data = {
            c: $("#text").val()
          }

          if ($("#private").prop("checked")) {
            data.p = 1;
          }

          if ($("#expire").val() > 0) {
            data.s = $("#expire").val();
          }

          return data;
        }

        function displayResponse(response) {
          $("#paste_error").hide();
          $("#paste_response").show();
          $("#response_url").attr("href", response.url);
          $("#response_url").text(response.url);
          $("#response_status").text(response.status);
          $("#response_uuid").text(response.uuid);
        }

        function displayError(text) {
          $("#paste_response").hide();
          $("#paste_error").show();
          $("#paste_error").text(text);
        }

        function parseResponse(data) {
           var response = new Object;

            if (!data) {
              $("#paste_response").hide();
              return;
            }

            $.each(data.split("\n"), function(k,v) {
              var property = v.split(": ");
              response[property[0]] = property[1];
            });

            return response;
        }

        function submitForm(route) {
          $.ajax({
            url: "https://ptpb.pw" + route,
            type: "POST",
            contentType: "multipart/form-data",
            data: getData(),
            success: function(data) {
              var response = parseResponse(data);
              console.log(response);
              displayResponse(response);
            },
            error: function(jqxhr) {
              console.log(jqxhr);
              displayError(jqxhr.responseText);
            }
          });
        }

        $("#paste").submit(function(e) {
          if (!$("#file").val()) {
            e.preventDefault();
            submitForm("/");
          }
        });

        $("#shorten").click(function(e) {
          e.preventDefault();
          submitForm("/u");
        });
      });
    </script>
    <div id="footer" class="center">
      <h6>Send all complaints to <a href="https://github.com/sudokode/pbwww" target="_blank">sudokode</a></h6>
    </div>
  </body>
</html>
